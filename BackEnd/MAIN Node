const express = require("express");
const multer = require("multer");
const exif = require("exif-js"); // You might need to use a package for EXIF extraction
const app = express();

// Configure file upload
const storage = multer.memoryStorage();
const upload = multer({ storage: storage });

app.post("/upload", upload.single("photo"), (req, res) => {
    const { buffer } = req.file;

    // Extract EXIF data (latitude, longitude)
    const exifData = exif.readFromBinaryFile(buffer);
    const latitude = exifData.GPSLatitude;
    const longitude = exifData.GPSLongitude;

    // Store image and metadata in database (Example: MongoDB)
    const photoData = {
        latitude,
        longitude,
        imageUrl: "/images/" + req.file.filename,
    };

    // Save to database (not shown)
    res.send("Image uploaded successfully!");
});

// Example route to fetch photos and coordinates from the database
app.get("/api/photos", (req, res) => {
    // Fetch the data from the database
    const photos = [
        { latitude: 40.7128, longitude: -74.0060, imageUrl: "/images/photo1.jpg" },
        // Add other photo data
    ];
    res.json(photos);
});

app.listen(3000, () => {
    console.log("Server running on port 3000");
});
